<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>APM:Libraries: libraries/APM_Control/AP_PitchController.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_50866fe7c3a898cfa96b79f21ec45884.html">APM_Control</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_PitchController.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__PitchController_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// -*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*-</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//  Initial Code by Jon Challinger</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">//  Modified by Paul Riseborough</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__PitchController_8h.html">AP_PitchController.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AP__PitchController_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code" href="classAP__PitchController.html#a496cadd98603208974848384da64db42">AP_PitchController::var_info</a>[] = {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// @Param: TCONST</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// @DisplayName: Pitch Time Constant</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// @Description: This controls the time constant in seconds from demanded to achieved pitch angle. A value of 0.5 is a good default and will work with nearly all models. Advanced users may want to reduce this time to obtain a faster response but there is no point setting a time less than the aircraft can achieve.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// @Range: 0.4 1.0</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// @Units: seconds</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TCONST&quot;</span>,      0, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.tau,       0.5f),</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// @Param: P</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// @DisplayName: Proportional Gain</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// @Description: This is the gain from pitch angle to elevator. This gain works the same way as PTCH2SRV_P in the old PID controller and can be set to the same value.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @Range: 0.1 3.0</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// @User: User</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;P&quot;</span>,        1, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.P,          0.4f),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// @Param: D</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @DisplayName: Damping Gain</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @Description: This is the gain from pitch rate to elevator. This adjusts the damping of the pitch control loop. It has the same effect as PTCH2SRV_D in the old PID controller and can be set to the same value, but without the spikes in servo demands. This gain helps to reduce pitching in turbulence. Some airframes such as flying wings that have poor pitch damping can benefit from increasing this gain term. This should be increased in 0.01 increments as too high a value can lead to a high frequency pitch oscillation that could overstress the airframe.</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @Range: 0 0.1</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// @User: User</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;D&quot;</span>,        2, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.D,        0.02f),</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// @Param: I</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// @DisplayName: Integrator Gain</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// @Description: This is the gain applied to the integral of pitch angle. It has the same effect as PTCH2SRV_I in the old PID controller and can be set to the same value. Increasing this gain causes the controller to trim out constant offsets between demanded and measured pitch angle.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// @Range: 0 0.5</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// @User: User</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;I&quot;</span>,        3, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.I,        0.04f),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// @Param: RMAX_UP</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// @DisplayName: Pitch up max rate</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// @Description: This sets the maximum nose up pitch rate that the controller will demand (degrees/sec). Setting it to zero disables the limit.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// @Range: 0 100</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// @Units: degrees/second</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RMAX_UP&quot;</span>,     4, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.rmax,   0.0f),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// @Param: RMAX_DN</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// @DisplayName: Pitch down max rate</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// @Description: This sets the maximum nose down pitch rate that the controller will demand (degrees/sec). Setting it to zero disables the limit.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// @Range: 0 100</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// @Units: degrees/second</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RMAX_DN&quot;</span>,     5, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, _max_rate_neg,   0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// @Param: RLL</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// @DisplayName: Roll compensation</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// @Description: This is the gain term that is applied to the pitch rate offset calculated as required to keep the nose level during turns. The default value is 1 which will work for all models. Advanced users can use it to correct for height variation in turns. If height is lost initially in turns this can be increased in small increments of 0.05 to compensate. If height is gained initially in turns then it can be decreased.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// @Range: 0.7 1.5</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// @User: User</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RLL&quot;</span>,      6, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, _roll_ff,        1.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>),</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// @Param: IMAX</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// @DisplayName: Integrator limit</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// @Description: This limits the number of centi-degrees of elevator over which the integrator will operate. At the default setting of 3000 centi-degrees, the integrator will be limited to +- 30 degrees of servo travel. The maximum servo deflection is +- 45 degrees, so the default value represents a 2/3rd of the total control throw which is adequate for most aircraft unless they are severely out of trim or have very limited elevator control effectiveness.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// @Range: 0 4500</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;IMAX&quot;</span>,      7, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.imax,     3000),</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// @Param: FF</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="comment">// @DisplayName: Feed forward Gain</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// @Description: This is the gain from demanded rate to elevator output. </span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// @Range: 0.1 4.0</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// @User: User</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FF&quot;</span>,        8, <a class="code" href="classAP__PitchController.html">AP_PitchController</a>, gains.FF,       0.0f),</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;};</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> Function returns an equivalent elevator deflection in centi-degrees in the range from -4500 to 4500</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> A positive demand is up</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> Inputs are: </span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> 1) demanded pitch rate in degrees/second</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> 2) control gain scaler = scaling_speed / aspeed</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> 3) boolean which is true when stabilise mode is active</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> 4) minimum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> 5) maximum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="classAP__PitchController.html#a4613b491d225c7ee7eac435f79d7c495">  115</a></span>&#160;int32_t <a class="code" href="classAP__PitchController.html#a4613b491d225c7ee7eac435f79d7c495">AP_PitchController::_get_rate_out</a>(<span class="keywordtype">float</span> desired_rate, <span class="keywordtype">float</span> scaler, <span class="keywordtype">bool</span> disable_integrator, <span class="keywordtype">float</span> aspeed)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    uint32_t tnow = hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">millis</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    uint32_t dt = tnow - <a class="code" href="classAP__PitchController.html#a0f6944516ae36f1b81373f59634a2737">_last_t</a>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (_last_t == 0 || dt &gt; 1000) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        dt = 0;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    _last_t = tnow;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">float</span> delta_time    = (float)dt * 0.001<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// Get body rate vector (radians/sec)</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">float</span> omega_y = <a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a667ec4ffbedf99e75c7d60e01f45df3a">get_gyro</a>().<a class="code" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// Calculate the pitch rate error (deg/sec) and scale</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">float</span> achieved_rate = <a class="code" href="AP__Common_8h.html#a3c9d151923236c7e8ccccf86f131e550">ToDeg</a>(omega_y);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">float</span> rate_error = (desired_rate - achieved_rate) * scaler;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">// Multiply pitch rate error by _ki_rate and integrate</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// Scaler is applied before integrator so that integrator state relates directly to elevator deflection</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// This means elevator trim offset doesn&#39;t change as the value of scaler changes with airspeed</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// Don&#39;t integrate if in stabilise mode as the integrator will wind up against the pilots inputs</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (!disable_integrator &amp;&amp; <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a80732db6eafbd29472ed5fa53393a1b4">I</a> &gt; 0) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordtype">float</span> ki_rate = <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a80732db6eafbd29472ed5fa53393a1b4">I</a> * <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a>;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">//only integrate if gain and time step are positive and airspeed above min value.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (dt &gt; 0 &amp;&amp; aspeed &gt; 0.5<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>*<span class="keywordtype">float</span>(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>)) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordtype">float</span> integrator_delta = rate_error * ki_rate * delta_time * scaler;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a> &lt; -45) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="comment">// prevent the integrator from increasing if surface defln demand is above the upper limit</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                integrator_delta = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(integrator_delta , 0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a> &gt; 45) {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="comment">// prevent the integrator from decreasing if surface defln demand  is below the lower limit</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                integrator_delta = <a class="code" href="AP__Math_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(integrator_delta , 0);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a> += integrator_delta;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a> = 0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// Scale the integration limit</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">float</span> intLimScaled = <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#ac38cf167f952abe2dbd50fb61e59d1f7">imax</a> * 0.01f;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// Constrain the integrator state</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a> = <a class="code" href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a>(<a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a>, -intLimScaled, intLimScaled);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// Calculate equivalent gains so that values for K_P and K_I can be taken across from the old PID law</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// No conversion is required for K_D</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">float</span> eas2tas = <a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a2648b5fc68b22e83205161cf1274939c">get_EAS2TAS</a>();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordtype">float</span> kp_ff = <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((<a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#aab65bd5ad1119fafa6fb9458d9bf1bbd">P</a> - <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a80732db6eafbd29472ed5fa53393a1b4">I</a> * <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a>) * <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a>  - <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#ae97cee671898c58d939cf265004a2ee0">D</a> , 0) / eas2tas;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">float</span> k_ff = <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a5cc36e979eaf92ba946a540de9554408">FF</a> / eas2tas;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Calculate the demanded control surface deflection</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// Note the scaler is applied again. We want a 1/speed scaler applied to the feed-forward</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">// path, but want a 1/speed^2 scaler applied to the rate error path. </span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// This is because acceleration scales with speed^2, but rate scales with speed.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#afded67a27b416d1a7d5a7af84c782de6">P</a> = desired_rate * kp_ff * scaler;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#af1dd0ab3a1d25f7f93b6a97c51ae4a15">FF</a> = desired_rate * k_ff * scaler;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a2c4183a4b3eaf152eb2d910eefee495c">D</a> = rate_error * <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#ae97cee671898c58d939cf265004a2ee0">D</a> * scaler;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a> = <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a2c4183a4b3eaf152eb2d910eefee495c">D</a> + <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#af1dd0ab3a1d25f7f93b6a97c51ae4a15">FF</a> + <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#afded67a27b416d1a7d5a7af84c782de6">P</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a039854d85412b90657a08d11358a286a">desired</a> = desired_rate;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a621136e9d3d5f571c96258c63c559384">autotune</a>.<a class="code" href="classAP__AutoTune.html#adeb8f372ebcb13377ff55c4126b0347f">running</a> &amp;&amp; aspeed &gt; <a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">// let autotune have a go at the values </span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Note that we don&#39;t pass the integrator component so we get</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// a better idea of how much the base PD controller</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">// contributed</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="classAP__PitchController.html#a621136e9d3d5f571c96258c63c559384">autotune</a>.<a class="code" href="classAP__AutoTune.html#af5c523db0ac4313e8098fec4b8f5f2f1">update</a>(desired_rate, achieved_rate, <a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// set down rate to rate up when auto-tuning</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="classAP__PitchController.html#a342617470b55c792a4ae975aa0af394c">_max_rate_neg</a>.set_and_save_ifchanged(<a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a891ccd18d45abf58d2dc1b896f751d41">rmax</a>);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a> += <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// Convert to centi-degrees and constrain</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a>(<a class="code" href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">_last_out</a> * 100, -4500, 4500);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"> Function returns an equivalent elevator deflection in centi-degrees in the range from -4500 to 4500</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"> A positive demand is up</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> Inputs are: </span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"> 1) demanded pitch rate in degrees/second</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> 2) control gain scaler = scaling_speed / aspeed</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> 3) boolean which is true when stabilise mode is active</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"> 4) minimum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> 5) maximum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classAP__PitchController.html#ad305f4274a77eaffb5b0dc064cfc31ba">  205</a></span>&#160;int32_t <a class="code" href="classAP__PitchController.html#ad305f4274a77eaffb5b0dc064cfc31ba">AP_PitchController::get_rate_out</a>(<span class="keywordtype">float</span> desired_rate, <span class="keywordtype">float</span> scaler)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">float</span> aspeed;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a39289d0dde31413ad172fcf2847fce4a">airspeed_estimate</a>(&amp;aspeed)) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// If no airspeed available use average of min and max</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        aspeed = 0.5f*(float(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>) + float(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a>));</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__PitchController.html#a4613b491d225c7ee7eac435f79d7c495">_get_rate_out</a>(desired_rate, scaler, <span class="keyword">false</span>, aspeed);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">  get the rate offset in degrees/second needed for pitch in body frame</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">  to maintain height in a coordinated turn.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">  Also returns the inverted flag and the estimated airspeed in m/s for</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">  use by the rest of the pitch controller</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classAP__PitchController.html#ac2b0f53b26df0f5ba87ac8c735ea839f">  222</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classAP__PitchController.html#ac2b0f53b26df0f5ba87ac8c735ea839f">AP_PitchController::_get_coordination_rate_offset</a>(<span class="keywordtype">float</span> &amp;aspeed, <span class="keywordtype">bool</span> &amp;inverted)<span class="keyword"> const</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">float</span> rate_offset;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">float</span> bank_angle = <a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">roll</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// limit bank angle between +- 80 deg if right way up</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (fabsf(bank_angle) &lt; <a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(90))    {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        bank_angle = <a class="code" href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a>(bank_angle,-<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(80),<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(80));</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        inverted = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        inverted = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span> (bank_angle &gt; 0.0<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            bank_angle = <a class="code" href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a>(bank_angle,<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(100),<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(180));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            bank_angle = <a class="code" href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a>(bank_angle,-<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(180),-<a class="code" href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a>(100));</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a39289d0dde31413ad172fcf2847fce4a">airspeed_estimate</a>(&amp;aspeed)) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// If no airspeed available use average of min and max</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        aspeed = 0.5f*(float(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>) + float(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">airspeed_max</a>));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (abs(<a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#af3394de208d1f96457382d79ab7a8d01">pitch_sensor</a>) &gt; 7000) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// don&#39;t do turn coordination handling when at very high pitch angles</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        rate_offset = 0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        rate_offset = cosf(<a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a>)*fabsf(<a class="code" href="AP__Common_8h.html#a3c9d151923236c7e8ccccf86f131e550">ToDeg</a>((<a class="code" href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a> / <a class="code" href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>((aspeed * <a class="code" href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">_ahrs</a>.<a class="code" href="classAP__AHRS.html#a2648b5fc68b22e83205161cf1274939c">get_EAS2TAS</a>()) , <span class="keywordtype">float</span>(<a class="code" href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">aparm</a>.<a class="code" href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">airspeed_min</a>))) * tanf(bank_angle) * sinf(bank_angle))) * <a class="code" href="classAP__PitchController.html#a5099a4efd6733b386d2df98553820c11">_roll_ff</a>;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (inverted) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        rate_offset = -rate_offset;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">return</span> rate_offset;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">// Function returns an equivalent elevator deflection in centi-degrees in the range from -4500 to 4500</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">// A positive demand is up</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">// Inputs are: </span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">// 1) demanded pitch angle in centi-degrees</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">// 2) control gain scaler = scaling_speed / aspeed</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">// 3) boolean which is true when stabilise mode is active</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">// 4) minimum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">// 5) maximum FBW airspeed (metres/sec)</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="classAP__PitchController.html#a705d9814ebad894375332f012dd768df">  264</a></span>&#160;int32_t <a class="code" href="classAP__PitchController.html#a705d9814ebad894375332f012dd768df">AP_PitchController::get_servo_out</a>(int32_t angle_err, <span class="keywordtype">float</span> scaler, <span class="keywordtype">bool</span> disable_integrator)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// Calculate offset to pitch rate demand required to maintain pitch angle whilst banking</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// Calculate ideal turn rate from bank angle and airspeed assuming a level coordinated turn</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// Pitch rate offset is the component of turn rate about the pitch axis</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordtype">float</span> aspeed;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">float</span> rate_offset;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordtype">bool</span> inverted;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a> &lt; 0.1f) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a>.set(0.1<a class="code" href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a>);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    rate_offset = <a class="code" href="classAP__PitchController.html#ac2b0f53b26df0f5ba87ac8c735ea839f">_get_coordination_rate_offset</a>(aspeed, inverted);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// Calculate the desired pitch rate (deg/sec) from the angle error</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">float</span> desired_rate = angle_err * 0.01f / <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">tau</a>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// limit the maximum pitch rate demand. Don&#39;t apply when inverted</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// as the rates will be tuned when upright, and it is common that</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// much higher rates are needed inverted    </span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (!inverted) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a342617470b55c792a4ae975aa0af394c">_max_rate_neg</a> &amp;&amp; desired_rate &lt; -<a class="code" href="classAP__PitchController.html#a342617470b55c792a4ae975aa0af394c">_max_rate_neg</a>) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            desired_rate = -<a class="code" href="classAP__PitchController.html#a342617470b55c792a4ae975aa0af394c">_max_rate_neg</a>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a891ccd18d45abf58d2dc1b896f751d41">rmax</a> &amp;&amp; desired_rate &gt; <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a891ccd18d45abf58d2dc1b896f751d41">rmax</a>) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            desired_rate = <a class="code" href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">gains</a>.<a class="code" href="structAP__AutoTune_1_1ATGains.html#a891ccd18d45abf58d2dc1b896f751d41">rmax</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> (inverted) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        desired_rate = -desired_rate;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// Apply the turn correction offset</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    desired_rate = desired_rate + rate_offset;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classAP__PitchController.html#a4613b491d225c7ee7eac435f79d7c495">_get_rate_out</a>(desired_rate, scaler, disable_integrator, aspeed);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="classAP__PitchController.html#a5d3a66aa66c9c337bb87fe10df4759b5">  303</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classAP__PitchController.html#a5d3a66aa66c9c337bb87fe10df4759b5">AP_PitchController::reset_I</a>()</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">_pid_info</a>.<a class="code" href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">I</a> = 0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="ttc" id="classAP__PitchController_html_ad305f4274a77eaffb5b0dc064cfc31ba"><div class="ttname"><a href="classAP__PitchController.html#ad305f4274a77eaffb5b0dc064cfc31ba">AP_PitchController::get_rate_out</a></div><div class="ttdeci">int32_t get_rate_out(float desired_rate, float scaler)</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8cpp_source.html#l00205">AP_PitchController.cpp:205</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a41a85fbfa7d39bf0b7ea1bf42038a2a4"><div class="ttname"><a href="classAP__PitchController.html#a41a85fbfa7d39bf0b7ea1bf42038a2a4">AP_PitchController::_ahrs</a></div><div class="ttdeci">AP_AHRS &amp; _ahrs</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00049">AP_PitchController.h:49</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a384a23e205126cf43e91bec9668b7ed0"><div class="ttname"><a href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">AP_AHRS::roll</a></div><div class="ttdeci">float roll</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00194">AP_AHRS.h:194</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_a26b68339fc68a562d8d3a1238d0ec8c1"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#a26b68339fc68a562d8d3a1238d0ec8c1">AP_HAL::Scheduler::millis</a></div><div class="ttdeci">virtual uint32_t millis()=0</div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_a891ccd18d45abf58d2dc1b896f751d41"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#a891ccd18d45abf58d2dc1b896f751d41">AP_AutoTune::ATGains::rmax</a></div><div class="ttdeci">AP_Int16 rmax</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00018">AP_AutoTune.h:18</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2648b5fc68b22e83205161cf1274939c"><div class="ttname"><a href="classAP__AHRS.html#a2648b5fc68b22e83205161cf1274939c">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00253">AP_AHRS.h:253</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a342617470b55c792a4ae975aa0af394c"><div class="ttname"><a href="classAP__PitchController.html#a342617470b55c792a4ae975aa0af394c">AP_PitchController::_max_rate_neg</a></div><div class="ttdeci">AP_Int16 _max_rate_neg</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00039">AP_PitchController.h:39</a></div></div>
<div class="ttc" id="structDataFlash__Class_1_1PID__Info_html_a2c4183a4b3eaf152eb2d910eefee495c"><div class="ttname"><a href="structDataFlash__Class_1_1PID__Info.html#a2c4183a4b3eaf152eb2d910eefee495c">DataFlash_Class::PID_Info::D</a></div><div class="ttdeci">float D</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00128">DataFlash.h:128</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a496cadd98603208974848384da64db42"><div class="ttname"><a href="classAP__PitchController.html#a496cadd98603208974848384da64db42">AP_PitchController::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00033">AP_PitchController.h:33</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="AP__Param_8h_html_abe1c2a65ce5455bf37f3c000b4241c00"><div class="ttname"><a href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, class, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00046">AP_Param.h:46</a></div></div>
<div class="ttc" id="classAP__AutoTune_html_af5c523db0ac4313e8098fec4b8f5f2f1"><div class="ttname"><a href="classAP__AutoTune.html#af5c523db0ac4313e8098fec4b8f5f2f1">AP_AutoTune::update</a></div><div class="ttdeci">void update(float desired_rate, float achieved_rate, float servo_out)</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8cpp_source.html#l00167">AP_AutoTune.cpp:167</a></div></div>
<div class="ttc" id="structDataFlash__Class_1_1PID__Info_html_afded67a27b416d1a7d5a7af84c782de6"><div class="ttname"><a href="structDataFlash__Class_1_1PID__Info.html#afded67a27b416d1a7d5a7af84c782de6">DataFlash_Class::PID_Info::P</a></div><div class="ttdeci">float P</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00126">DataFlash.h:126</a></div></div>
<div class="ttc" id="classAP__PitchController_html"><div class="ttname"><a href="classAP__PitchController.html">AP_PitchController</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00013">AP_PitchController.h:13</a></div></div>
<div class="ttc" id="classAP__PitchController_html_ac2b0f53b26df0f5ba87ac8c735ea839f"><div class="ttname"><a href="classAP__PitchController.html#ac2b0f53b26df0f5ba87ac8c735ea839f">AP_PitchController::_get_coordination_rate_offset</a></div><div class="ttdeci">float _get_coordination_rate_offset(float &amp;aspeed, bool &amp;inverted) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8cpp_source.html#l00222">AP_PitchController.cpp:222</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a75b14352ec1c95a8276af9a0813cfdc3"><div class="ttname"><a href="AP__Math_8h.html#a75b14352ec1c95a8276af9a0813cfdc3">radians</a></div><div class="ttdeci">static float radians(float deg)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00195">AP_Math.h:195</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a2aa61744614d8e0ef64803583359a56e"><div class="ttname"><a href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">AP_AHRS::pitch</a></div><div class="ttdeci">float pitch</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00195">AP_AHRS.h:195</a></div></div>
<div class="ttc" id="AP__Math_8h_html_a27149a7dfbb14319088e8332705c0046"><div class="ttname"><a href="AP__Math_8h.html#a27149a7dfbb14319088e8332705c0046">constrain_float</a></div><div class="ttdeci">static float constrain_float(float amt, float low, float high)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00170">AP_Math.h:170</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_ab774cbd438b0d68da5250de61dca6262"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#ab774cbd438b0d68da5250de61dca6262">AP_Vehicle::FixedWing::airspeed_max</a></div><div class="ttdeci">AP_Int16 airspeed_max</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00037">AP_Vehicle.h:37</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a39289d0dde31413ad172fcf2847fce4a"><div class="ttname"><a href="classAP__AHRS.html#a39289d0dde31413ad172fcf2847fce4a">AP_AHRS::airspeed_estimate</a></div><div class="ttdeci">virtual bool airspeed_estimate(float *airspeed_ret) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8cpp_source.html#l00130">AP_AHRS.cpp:130</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a0f6944516ae36f1b81373f59634a2737"><div class="ttname"><a href="classAP__PitchController.html#a0f6944516ae36f1b81373f59634a2737">AP_PitchController::_last_t</a></div><div class="ttdeci">uint32_t _last_t</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00041">AP_PitchController.h:41</a></div></div>
<div class="ttc" id="classAP__AHRS_html_a667ec4ffbedf99e75c7d60e01f45df3a"><div class="ttname"><a href="classAP__AHRS.html#a667ec4ffbedf99e75c7d60e01f45df3a">AP_AHRS::get_gyro</a></div><div class="ttdeci">virtual const Vector3f &amp; get_gyro(void) const  =0</div></div>
<div class="ttc" id="classAP__AutoTune_html_adeb8f372ebcb13377ff55c4126b0347f"><div class="ttname"><a href="classAP__AutoTune.html#adeb8f372ebcb13377ff55c4126b0347f">AP_AutoTune::running</a></div><div class="ttdeci">bool running</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00054">AP_AutoTune.h:54</a></div></div>
<div class="ttc" id="AP__Common_8h_html_a3c9d151923236c7e8ccccf86f131e550"><div class="ttname"><a href="AP__Common_8h.html#a3c9d151923236c7e8ccccf86f131e550">ToDeg</a></div><div class="ttdeci">#define ToDeg(x)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00066">AP_Common.h:66</a></div></div>
<div class="ttc" id="structDataFlash__Class_1_1PID__Info_html_af1dd0ab3a1d25f7f93b6a97c51ae4a15"><div class="ttname"><a href="structDataFlash__Class_1_1PID__Info.html#af1dd0ab3a1d25f7f93b6a97c51ae4a15">DataFlash_Class::PID_Info::FF</a></div><div class="ttdeci">float FF</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00129">DataFlash.h:129</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ac6afabdc09a49a433ee19d8a9486056d"><div class="ttname"><a href="AP__Math_8h.html#ac6afabdc09a49a433ee19d8a9486056d">min</a></div><div class="ttdeci">#define min(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00225">AP_Math.h:225</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_ac38cf167f952abe2dbd50fb61e59d1f7"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#ac38cf167f952abe2dbd50fb61e59d1f7">AP_AutoTune::ATGains::imax</a></div><div class="ttdeci">AP_Int16 imax</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00019">AP_AutoTune.h:19</a></div></div>
<div class="ttc" id="classAP__PitchController_html_aeadd7553821fddd7eb63e25c3596e149"><div class="ttname"><a href="classAP__PitchController.html#aeadd7553821fddd7eb63e25c3596e149">AP_PitchController::_pid_info</a></div><div class="ttdeci">DataFlash_Class::PID_Info _pid_info</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00044">AP_PitchController.h:44</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_ae97cee671898c58d939cf265004a2ee0"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#ae97cee671898c58d939cf265004a2ee0">AP_AutoTune::ATGains::D</a></div><div class="ttdeci">AP_Float D</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00016">AP_AutoTune.h:16</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a5099a4efd6733b386d2df98553820c11"><div class="ttname"><a href="classAP__PitchController.html#a5099a4efd6733b386d2df98553820c11">AP_PitchController::_roll_ff</a></div><div class="ttdeci">AP_Float _roll_ff</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00040">AP_PitchController.h:40</a></div></div>
<div class="ttc" id="AP__Math_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="AP__Math_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00224">AP_Math.h:224</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a68d470a4ed1f00068df54187122fbb79"><div class="ttname"><a href="classAP__PitchController.html#a68d470a4ed1f00068df54187122fbb79">AP_PitchController::gains</a></div><div class="ttdeci">AP_AutoTune::ATGains gains</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00037">AP_PitchController.h:37</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00015">HAL.h:15</a></div></div>
<div class="ttc" id="classAP__AHRS_html_af3394de208d1f96457382d79ab7a8d01"><div class="ttname"><a href="classAP__AHRS.html#af3394de208d1f96457382d79ab7a8d01">AP_AHRS::pitch_sensor</a></div><div class="ttdeci">int32_t pitch_sensor</div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00200">AP_AHRS.h:200</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_aab65bd5ad1119fafa6fb9458d9bf1bbd"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#aab65bd5ad1119fafa6fb9458d9bf1bbd">AP_AutoTune::ATGains::P</a></div><div class="ttdeci">AP_Float P</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00014">AP_AutoTune.h:14</a></div></div>
<div class="ttc" id="DerivativeFilter_8cpp_html_a357394e0f6f88c8a57bd893ab28dc8f8"><div class="ttname"><a href="DerivativeFilter_8cpp.html#a357394e0f6f88c8a57bd893ab28dc8f8">f</a></div><div class="ttdeci">#define f(i)</div></div>
<div class="ttc" id="classVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition:</b> <a href="vector3_8h_source.html#l00070">vector3.h:70</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00078">AP_Param.h:78</a></div></div>
<div class="ttc" id="AP__PitchController_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__PitchController_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="AC__PID__test_8cpp_source.html#l00010">AC_PID_test.cpp:10</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a71849b4f3788c90e79f33a46d733635d"><div class="ttname"><a href="classAP__PitchController.html#a71849b4f3788c90e79f33a46d733635d">AP_PitchController::_last_out</a></div><div class="ttdeci">float _last_out</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00042">AP_PitchController.h:42</a></div></div>
<div class="ttc" id="structAP__Vehicle_1_1FixedWing_html_a88300cf5dda0e0f3cb5669c564756039"><div class="ttname"><a href="structAP__Vehicle_1_1FixedWing.html#a88300cf5dda0e0f3cb5669c564756039">AP_Vehicle::FixedWing::airspeed_min</a></div><div class="ttdeci">AP_Int16 airspeed_min</div><div class="ttdef"><b>Definition:</b> <a href="AP__Vehicle_8h_source.html#l00036">AP_Vehicle.h:36</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a5d3a66aa66c9c337bb87fe10df4759b5"><div class="ttname"><a href="classAP__PitchController.html#a5d3a66aa66c9c337bb87fe10df4759b5">AP_PitchController::reset_I</a></div><div class="ttdeci">void reset_I()</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8cpp_source.html#l00303">AP_PitchController.cpp:303</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a621136e9d3d5f571c96258c63c559384"><div class="ttname"><a href="classAP__PitchController.html#a621136e9d3d5f571c96258c63c559384">AP_PitchController::autotune</a></div><div class="ttdeci">AP_AutoTune autotune</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00038">AP_PitchController.h:38</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_a80732db6eafbd29472ed5fa53393a1b4"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#a80732db6eafbd29472ed5fa53393a1b4">AP_AutoTune::ATGains::I</a></div><div class="ttdeci">AP_Float I</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00015">AP_AutoTune.h:15</a></div></div>
<div class="ttc" id="structDataFlash__Class_1_1PID__Info_html_a039854d85412b90657a08d11358a286a"><div class="ttname"><a href="structDataFlash__Class_1_1PID__Info.html#a039854d85412b90657a08d11358a286a">DataFlash_Class::PID_Info::desired</a></div><div class="ttdeci">float desired</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00125">DataFlash.h:125</a></div></div>
<div class="ttc" id="AP__PitchController_8h_html"><div class="ttname"><a href="AP__PitchController_8h.html">AP_PitchController.h</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a228143d57aebd07b59b61f43959ccc6a"><div class="ttname"><a href="classAP__PitchController.html#a228143d57aebd07b59b61f43959ccc6a">AP_PitchController::aparm</a></div><div class="ttdeci">const AP_Vehicle::FixedWing &amp; aparm</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8h_source.html#l00036">AP_PitchController.h:36</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a705d9814ebad894375332f012dd768df"><div class="ttname"><a href="classAP__PitchController.html#a705d9814ebad894375332f012dd768df">AP_PitchController::get_servo_out</a></div><div class="ttdeci">int32_t get_servo_out(int32_t angle_err, float scaler, bool disable_integrator)</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8cpp_source.html#l00264">AP_PitchController.cpp:264</a></div></div>
<div class="ttc" id="AP__Math_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="AP__Math_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition:</b> <a href="AP__Math_8h_source.html#l00047">AP_Math.h:47</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_afd8a5b186e0a2166f45d8285d72e1c32"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#afd8a5b186e0a2166f45d8285d72e1c32">AP_AutoTune::ATGains::tau</a></div><div class="ttdeci">AP_Float tau</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00013">AP_AutoTune.h:13</a></div></div>
<div class="ttc" id="classAP__PitchController_html_a4613b491d225c7ee7eac435f79d7c495"><div class="ttname"><a href="classAP__PitchController.html#a4613b491d225c7ee7eac435f79d7c495">AP_PitchController::_get_rate_out</a></div><div class="ttdeci">int32_t _get_rate_out(float desired_rate, float scaler, bool disable_integrator, float aspeed)</div><div class="ttdef"><b>Definition:</b> <a href="AP__PitchController_8cpp_source.html#l00115">AP_PitchController.cpp:115</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00053">AP_Param.h:53</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00087">HAL.h:87</a></div></div>
<div class="ttc" id="structDataFlash__Class_1_1PID__Info_html_a224dedbec9a0e3d1a5e160c2827d1551"><div class="ttname"><a href="structDataFlash__Class_1_1PID__Info.html#a224dedbec9a0e3d1a5e160c2827d1551">DataFlash_Class::PID_Info::I</a></div><div class="ttdeci">float I</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00127">DataFlash.h:127</a></div></div>
<div class="ttc" id="structAP__AutoTune_1_1ATGains_html_a5cc36e979eaf92ba946a540de9554408"><div class="ttname"><a href="structAP__AutoTune_1_1ATGains.html#a5cc36e979eaf92ba946a540de9554408">AP_AutoTune::ATGains::FF</a></div><div class="ttdeci">AP_Float FF</div><div class="ttdef"><b>Definition:</b> <a href="AP__AutoTune_8h_source.html#l00017">AP_AutoTune.h:17</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 14 2015 23:43:18 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
