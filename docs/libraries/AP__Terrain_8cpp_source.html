<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>APM:Libraries: libraries/AP_Terrain/AP_Terrain.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_f928a1ceb1b35bc625539098c2ce4b5a.html">AP_Terrain</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AP_Terrain.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="AP__Terrain_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// -*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*-</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Common_8h.html">AP_Common/AP_Common.h</a>&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS__MAVLink_8h.html">GCS_MAVLink/GCS_MAVLink.h</a>&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="DataFlash_8h.html">DataFlash/DataFlash.h</a>&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="AP__Terrain_8h.html">AP_Terrain.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#if AP_TERRAIN_AVAILABLE</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code" href="AC__PosControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// table of user settable parameters</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">const</span> <a class="code" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> AP_Terrain::var_info[] = {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// @Param: ENABLE</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// @DisplayName: Terrain data enable</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// @Description: enable terrain data. This enables the vehicle storing a database of terrain data on the SD card. The terrain data is requested from the ground station as needed, and stored for later use on the SD card. To be useful the ground station must support TERRAIN_REQUEST messages and have access to a terrain database, such as the SRTM database.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// @Values: 0:Disable,1:Enable</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ENABLE&quot;</span>,    0, AP_Terrain, enable, 1),</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// @Param: SPACING</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// @DisplayName: Terrain grid spacing</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// @Description: Distance between terrain grid points in meters. This controls the horizontal resolution of the terrain data that is stored on te SD card and requested from the ground station. If your GCS is using the worldwide SRTM database then a resolution of 100 meters is appropriate. Some parts of the world may have higher resolution data available, such as 30 meter data available in the SRTM database in the USA. The grid spacing also controls how much data is kept in memory during flight. A larger grid spacing will allow for a larger amount of data in memory. A grid spacing of 100 meters results in the vehicle keeping 12 grid squares in memory with each grid square having a size of 2.7 kilometers by 3.2 kilometers. Any additional grid squares are stored on the SD once they are fetched from the GCS and will be demand loaded as needed.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// @Units: meters</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SPACING&quot;</span>,   1, AP_Terrain, grid_spacing, 100),</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;};</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// constructor</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;AP_Terrain::AP_Terrain(<a class="code" href="classAP__AHRS.html">AP_AHRS</a> &amp;_ahrs, <span class="keyword">const</span> <a class="code" href="classAP__Mission.html">AP_Mission</a> &amp;_mission, <span class="keyword">const</span> <a class="code" href="classAP__Rally.html">AP_Rally</a> &amp;_rally) :</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>(_ahrs),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    mission(_mission),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    rally(_rally),</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    disk_io_state(DiskIoIdle),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    fd(-1),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    timer_setup(false),</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    file_lat_degrees(0),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    file_lon_degrees(0),</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    io_failure(false),</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    directory_created(false),</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    home_height(0),</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    have_current_loc_height(false),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    last_current_loc_height(0)</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    memset(&amp;home_loc, 0, <span class="keyword">sizeof</span>(home_loc));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    memset(&amp;disk_block, 0, <span class="keyword">sizeof</span>(disk_block));</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    memset(last_request_time_ms, 0, <span class="keyword">sizeof</span>(last_request_time_ms));</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">  return terrain height in meters above average sea level (WGS84) for</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">  a given position</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  This is the base function that other height calculations are derived</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">  from. The functions below are more convenient for most uses</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">  This function costs about 20 microseconds on Pixhawk</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keywordtype">bool</span> AP_Terrain::height_amsl(<span class="keyword">const</span> <a class="code" href="structLocation.html">Location</a> &amp;loc, <span class="keywordtype">float</span> &amp;height)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (!enable || !allocate()) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// quick access for home altitude</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == home_loc.lat &amp;&amp;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> == home_loc.lng) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        height = home_height;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">struct </span>grid_info info;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    calculate_grid_info(loc, info);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// find the grid</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">const</span> <span class="keyword">struct </span>grid_block &amp;grid = find_grid_cache(info).grid;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">      note that we rely on the one square overlap to ensure these</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">      calculations don&#39;t go past the end of the arrays</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    ASSERT_RANGE(info.idx_x, 0, TERRAIN_GRID_BLOCK_SIZE_X-2);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    ASSERT_RANGE(info.idx_y, 0, TERRAIN_GRID_BLOCK_SIZE_Y-2);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// check we have all 4 required heights</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> (!check_bitmap(grid, info.idx_x,   info.idx_y) ||</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        !check_bitmap(grid, info.idx_x,   info.idx_y+1) ||</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        !check_bitmap(grid, info.idx_x+1, info.idx_y) ||</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        !check_bitmap(grid, info.idx_x+1, info.idx_y+1)) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// hXY are the heights of the 4 surrounding grid points</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    int16_t h00, h01, h10, h11;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    h00 = grid.height[info.idx_x+0][info.idx_y+0];</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    h01 = grid.height[info.idx_x+0][info.idx_y+1];</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    h10 = grid.height[info.idx_x+1][info.idx_y+0];</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    h11 = grid.height[info.idx_x+1][info.idx_y+1];</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// do a simple dual linear interpolation. We could do something</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// fancier, but it probably isn&#39;t worth it as long as the</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// grid_spacing is kept small enough</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">float</span> avg1 = (1.0f-info.frac_x) * h00  + info.frac_x * h10;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">float</span> avg2 = (1.0f-info.frac_x) * h01  + info.frac_x * h11;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">float</span> avg  = (1.0f-info.frac_y) * avg1 + info.frac_y * avg2;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    height = avg;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    if (loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == <a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> &amp;&amp;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> == <a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// remember home altitude as a special case</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        home_height = height;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        home_loc = loc;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">   find difference between home terrain height and the terrain height</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">   at a given location, in meters. A positive result means the terrain</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">   is higher than home.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">   return false is terrain at the given location or at home</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">   location is not available</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordtype">bool</span> AP_Terrain::height_terrain_difference_home(<span class="keywordtype">float</span> &amp;terrain_difference, <span class="keywordtype">bool</span> extrapolate)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">float</span> height_home, height_loc;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (!height_amsl(<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>(), height_home)) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// we don&#39;t know the height of home</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="structLocation.html">Location</a> loc;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">get_position</a>(loc)) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// we don&#39;t know where we are</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> (!height_amsl(loc, height_loc)) {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">if</span> (!extrapolate || !have_current_loc_height) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="comment">// we don&#39;t know the height of the given location</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">// we don&#39;t have data at the current location, but the caller</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// has asked for extrapolation, so use the last available</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">// terrain height. This can be used to fill in while new data</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// is fetched. It should be very rarely used</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        height_loc = last_current_loc_height;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    terrain_difference = height_loc - height_home;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">   return current height above terrain at current AHRS</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">   position. </span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">   If extrapolate is true then extrapolate from most recently</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">   available terrain data is terrain data is not available for the</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">   current location.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">   Return true if height is available, otherwise false.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">bool</span> AP_Terrain::height_above_terrain(<span class="keywordtype">float</span> &amp;terrain_altitude, <span class="keywordtype">bool</span> extrapolate)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;{</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">float</span> terrain_difference;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (!height_terrain_difference_home(terrain_difference, extrapolate)) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="structLocation.html">Location</a> loc;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">get_position</a>(loc)) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// we don&#39;t know where we are</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">float</span> relative_home_altitude = loc.<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>*0.01f;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (!loc.<a class="code" href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">flags</a>.<a class="code" href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">relative_alt</a>) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// loc.alt has home altitude added, remove it</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        relative_home_altitude -= <a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>().<a class="code" href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>*0.01f;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    terrain_altitude = relative_home_altitude - terrain_difference;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">   return estimated equivalent relative-to-home altitude in meters</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">   of a given height above the terrain at the current location</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">       </span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">   This function allows existing height controllers which work on</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">   barometric altitude (relative to home) to be used with terrain</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">   based target altitude, by translating the &quot;above terrain&quot; altitude</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">   into an equivalent barometric relative height.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">   return false if terrain data is not available either at the given</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">   location or at the home location.  </span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">   </span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">   If extrapolate is true then allow return of an extrapolated</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">   terrain altitude based on the last available data</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordtype">bool</span> AP_Terrain::height_relative_home_equivalent(<span class="keywordtype">float</span> terrain_altitude, </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                                 <span class="keywordtype">float</span> &amp;relative_home_altitude,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                 <span class="keywordtype">bool</span> extrapolate)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">float</span> terrain_difference;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (!height_terrain_difference_home(terrain_difference, extrapolate)) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    relative_home_altitude = terrain_altitude + terrain_difference;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;}</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  calculate lookahead rise in terrain. This returns extra altitude</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  needed to clear upcoming terrain in meters</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="keywordtype">float</span> AP_Terrain::lookahead(<span class="keywordtype">float</span> <a class="code" href="examples_2location_2location_8cpp.html#af6eb7f864211ea48ab64c74d4f69fa41">bearing</a>, <span class="keywordtype">float</span> <a class="code" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a>, <span class="keywordtype">float</span> climb_ratio)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">if</span> (!enable || !allocate() || grid_spacing &lt;= 0) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="structLocation.html">Location</a> loc;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">get_position</a>(loc)) {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// we don&#39;t know where we are</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">float</span> base_height;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (!height_amsl(loc, base_height)) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// we don&#39;t know our current terrain height</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">float</span> climb = 0;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordtype">float</span> lookahead_estimate = 0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// check for terrain at grid spacing intervals</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">while</span> (distance &gt; 0) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a>(loc, bearing, grid_spacing);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        climb += climb_ratio * grid_spacing;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        distance -= grid_spacing;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordtype">float</span> height;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">if</span> (height_amsl(loc, height)) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordtype">float</span> rise = (height - base_height) - climb;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span> (rise &gt; lookahead_estimate) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                lookahead_estimate = rise;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">return</span> lookahead_estimate;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">  1hz update function. This is here to ensure progress is made on disk</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">  IO even if no MAVLink send_request() operations are called for a</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">  while.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordtype">void</span> AP_Terrain::update(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// just schedule any needed disk IO</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    schedule_disk_io();</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// try to ensure the home location is populated</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">float</span> height;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    height_amsl(<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">get_home</a>(), height);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// update the cached current location height</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="structLocation.html">Location</a> loc;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">bool</span> pos_valid = <a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">get_position</a>(loc);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordtype">bool</span> terrain_valid = height_amsl(loc, height);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (pos_valid &amp;&amp; terrain_valid) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        last_current_loc_height = height;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        have_current_loc_height = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// check for pending mission data</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    update_mission_data();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// check for pending rally data</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    update_rally_data();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// update capabilities and status</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (enable) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code" href="classAP__HAL_1_1Util.html#a572ac7ba3f6edcdc5ef6ce0e6d59069b">set_capabilities</a>(<a class="code" href="common_8h.html#a1cc09547d766033f0a71e9d85962dd39aac61e259fc52c256cd9af40eff40dbac">MAV_PROTOCOL_CAPABILITY_TERRAIN</a>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">if</span> (!pos_valid) {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment">// we don&#39;t know where we are</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            system_status = TerrainStatusUnhealthy;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!terrain_valid) {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// we don&#39;t have terrain data at current location</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            system_status = TerrainStatusUnhealthy;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            system_status = TerrainStatusOK;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        hal.<a class="code" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code" href="classAP__HAL_1_1Util.html#a7ed7f0dfb85d7408c9edbd7073f8c87a">clear_capabilities</a>(<a class="code" href="common_8h.html#a1cc09547d766033f0a71e9d85962dd39aac61e259fc52c256cd9af40eff40dbac">MAV_PROTOCOL_CAPABILITY_TERRAIN</a>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        system_status = TerrainStatusDisabled;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">  log terrain data to dataflash log</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">void</span> AP_Terrain::log_terrain_data(<a class="code" href="classDataFlash__Class.html">DataFlash_Class</a> &amp;dataflash)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;{</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (!enable) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="structLocation.html">Location</a> loc;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a>.<a class="code" href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">get_position</a>(loc)) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="comment">// we don&#39;t know where we are</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">float</span> terrain_height = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">float</span> current_height = 0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    uint16_t pending, loaded;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    height_amsl(loc, terrain_height);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    height_above_terrain(current_height, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    get_statistics(pending, loaded);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlog__TERRAIN.html">log_TERRAIN</a> pkt = {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="DataFlash_8h.html#abca6b52da10346c72b10dd04698e4420">LOG_PACKET_HEADER_INIT</a>(<a class="code" href="DataFlash_8h.html#abb538c2d6b6fe352804f947787a3e378a56f0896cdc3abc3a60a2c5c913b8e0f1">LOG_TERRAIN_MSG</a>),</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="structlog__TERRAIN.html#af643a3774749ea472f35bdbb75b873f4">time_us</a>        : hal.<a class="code" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code" href="classAP__HAL_1_1Scheduler.html#acfe178fdca7f8d9b22a939b3aac1a84f">micros64</a>(),</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="RCOutput__Bebop_8cpp.html#ade818037fd6c985038ff29656089758d">status</a>         : (uint8_t)<a class="code" href="RCOutput__Bebop_8cpp.html#ade818037fd6c985038ff29656089758d">status</a>(),</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="structlog__TERRAIN.html#ad348833c7bd058584ee171f80d3efc8f">lat</a>            : loc.<a class="code" href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>,</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="structlog__TERRAIN.html#aa617e5b283a3b8dad4b2239438293ad2">lng</a>            : loc.<a class="code" href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="structlog__TERRAIN.html#a5d3b10ce93149029433210fda7d393ed">spacing</a>        : (uint16_t)grid_spacing,</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        terrain_height : terrain_height,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        current_height : current_height,</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        pending        : pending,</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        loaded         : loaded</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    };</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    dataflash.<a class="code" href="classDataFlash__Class.html#a2838cdd106ad3dd8da69a45dd64117ca">WriteBlock</a>(&amp;pkt, <span class="keyword">sizeof</span>(pkt));</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">  allocate terrain cache. Making this dynamically allocated allows</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">  memory to be saved when terrain functionality is disabled</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keywordtype">bool</span> AP_Terrain::allocate(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;{</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> (enable == 0) {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (cache != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    cache = (<span class="keyword">struct </span>grid_cache *)calloc(TERRAIN_GRID_BLOCK_CACHE_SIZE, <span class="keyword">sizeof</span>(cache[0]));</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (cache == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        enable.set(0);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a>(<a class="code" href="common_8h.html#abbfa4e521655407a6255d8db29b33bc5aae6d84be2adb83c86bd95ed9c3e95499">MAV_SEVERITY_CRITICAL</a>, <span class="stringliteral">&quot;Terrain: allocation failed&quot;</span>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    cache_size = TERRAIN_GRID_BLOCK_CACHE_SIZE;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#endif // AP_TERRAIN_AVAILABLE</span></div>
<div class="ttc" id="classAP__HAL_1_1Scheduler_html_acfe178fdca7f8d9b22a939b3aac1a84f"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#acfe178fdca7f8d9b22a939b3aac1a84f">AP_HAL::Scheduler::micros64</a></div><div class="ttdeci">virtual uint64_t micros64()=0</div></div>
<div class="ttc" id="structlog__TERRAIN_html_ad348833c7bd058584ee171f80d3efc8f"><div class="ttname"><a href="structlog__TERRAIN.html#ad348833c7bd058584ee171f80d3efc8f">log_TERRAIN::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00597">DataFlash.h:597</a></div></div>
<div class="ttc" id="classAP__Rally_html"><div class="ttname"><a href="classAP__Rally.html">AP_Rally</a></div><div class="ttdoc">Object managing Rally Points. </div><div class="ttdef"><b>Definition:</b> <a href="AP__Rally_8h_source.html#l00040">AP_Rally.h:40</a></div></div>
<div class="ttc" id="classGCS__MAVLINK_html_ae1d5ebd46ec3ddb644862c747e2968bf"><div class="ttname"><a href="classGCS__MAVLINK.html#ae1d5ebd46ec3ddb644862c747e2968bf">GCS_MAVLINK::send_statustext_all</a></div><div class="ttdeci">static void send_statustext_all(MAV_SEVERITY severity, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="GCS__Common_8cpp_source.html#l01153">GCS_Common.cpp:1153</a></div></div>
<div class="ttc" id="AP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="AP__Param_8h_html_abe1c2a65ce5455bf37f3c000b4241c00"><div class="ttname"><a href="AP__Param_8h.html#abe1c2a65ce5455bf37f3c000b4241c00">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, class, element, def)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00046">AP_Param.h:46</a></div></div>
<div class="ttc" id="GCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System. </div></div>
<div class="ttc" id="classAP__Mission_html"><div class="ttname"><a href="classAP__Mission.html">AP_Mission</a></div><div class="ttdoc">Object managing Mission. </div><div class="ttdef"><b>Definition:</b> <a href="AP__Mission_8h_source.html#l00045">AP_Mission.h:45</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Util_html_a7ed7f0dfb85d7408c9edbd7073f8c87a"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a7ed7f0dfb85d7408c9edbd7073f8c87a">AP_HAL::Util::clear_capabilities</a></div><div class="ttdeci">void clear_capabilities(uint64_t cap)</div><div class="ttdef"><b>Definition:</b> <a href="Util_8h_source.html#l00020">Util.h:20</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00088">HAL.h:88</a></div></div>
<div class="ttc" id="classAP__HAL_1_1Util_html_a572ac7ba3f6edcdc5ef6ce0e6d59069b"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a572ac7ba3f6edcdc5ef6ce0e6d59069b">AP_HAL::Util::set_capabilities</a></div><div class="ttdeci">void set_capabilities(uint64_t cap)</div><div class="ttdef"><b>Definition:</b> <a href="Util_8h_source.html#l00019">Util.h:19</a></div></div>
<div class="ttc" id="classAP__AHRS_html"><div class="ttname"><a href="classAP__AHRS.html">AP_AHRS</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00048">AP_AHRS.h:48</a></div></div>
<div class="ttc" id="structlog__TERRAIN_html_a5d3b10ce93149029433210fda7d393ed"><div class="ttname"><a href="structlog__TERRAIN.html#a5d3b10ce93149029433210fda7d393ed">log_TERRAIN::spacing</a></div><div class="ttdeci">uint16_t spacing</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00599">DataFlash.h:599</a></div></div>
<div class="ttc" id="AC__PosControl_8cpp_html_a240c1a4ae2a70d1855f91e4a0b1ac938"><div class="ttname"><a href="AC__PosControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdoc">-*- tab-width: 4; Mode: C++; c-basic-offset: 4; indent-tabs-mode: nil -*- </div><div class="ttdef"><b>Definition:</b> <a href="PX4_2UARTDriver_8cpp_source.html#l00039">UARTDriver.cpp:39</a></div></div>
<div class="ttc" id="RCOutput__Bebop_8cpp_html_ade818037fd6c985038ff29656089758d"><div class="ttname"><a href="RCOutput__Bebop_8cpp.html#ade818037fd6c985038ff29656089758d">status</a></div><div class="ttdeci">uint8_t status</div><div class="ttdef"><b>Definition:</b> <a href="RCOutput__Bebop_8cpp_source.html#l00024">RCOutput_Bebop.cpp:24</a></div></div>
<div class="ttc" id="examples_2location_2location_8cpp_html_a06f14a9abd47b91465f895d5259cdc1b"><div class="ttname"><a href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a></div><div class="ttdeci">float distance</div><div class="ttdef"><b>Definition:</b> <a href="examples_2location_2location_8cpp_source.html#l00090">location.cpp:90</a></div></div>
<div class="ttc" id="structLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="structLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdoc">param 3 - Lattitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00123">AP_Common.h:123</a></div></div>
<div class="ttc" id="structlog__TERRAIN_html_af643a3774749ea472f35bdbb75b873f4"><div class="ttname"><a href="structlog__TERRAIN.html#af643a3774749ea472f35bdbb75b873f4">log_TERRAIN::time_us</a></div><div class="ttdeci">uint64_t time_us</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00595">DataFlash.h:595</a></div></div>
<div class="ttc" id="structlog__TERRAIN_html_aa617e5b283a3b8dad4b2239438293ad2"><div class="ttname"><a href="structlog__TERRAIN.html#aa617e5b283a3b8dad4b2239438293ad2">log_TERRAIN::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00598">DataFlash.h:598</a></div></div>
<div class="ttc" id="GCS__MAVLink_8h_html"><div class="ttname"><a href="GCS__MAVLink_8h.html">GCS_MAVLink.h</a></div><div class="ttdoc">One size fits all header for MAVLink integration. </div></div>
<div class="ttc" id="classAP__AHRS_html_aea45b16e6469a3b392b8bf52fb864732"><div class="ttname"><a href="classAP__AHRS.html#aea45b16e6469a3b392b8bf52fb864732">AP_AHRS::get_home</a></div><div class="ttdeci">const struct Location &amp; get_home(void) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS_8h_source.html#l00358">AP_AHRS.h:358</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00015">HAL.h:15</a></div></div>
<div class="ttc" id="structLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="structLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdoc">param 2 - Altitude in centimeters (meters * 100) </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00122">AP_Common.h:122</a></div></div>
<div class="ttc" id="common_8h_html_a1cc09547d766033f0a71e9d85962dd39aac61e259fc52c256cd9af40eff40dbac"><div class="ttname"><a href="common_8h.html#a1cc09547d766033f0a71e9d85962dd39aac61e259fc52c256cd9af40eff40dbac">MAV_PROTOCOL_CAPABILITY_TERRAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00539">common.h:539</a></div></div>
<div class="ttc" id="examples_2location_2location_8cpp_html_af6eb7f864211ea48ab64c74d4f69fa41"><div class="ttname"><a href="examples_2location_2location_8cpp.html#af6eb7f864211ea48ab64c74d4f69fa41">bearing</a></div><div class="ttdeci">float bearing</div><div class="ttdef"><b>Definition:</b> <a href="examples_2location_2location_8cpp_source.html#l00090">location.cpp:90</a></div></div>
<div class="ttc" id="common_8h_html_abbfa4e521655407a6255d8db29b33bc5aae6d84be2adb83c86bd95ed9c3e95499"><div class="ttname"><a href="common_8h.html#abbfa4e521655407a6255d8db29b33bc5aae6d84be2adb83c86bd95ed9c3e95499">MAV_SEVERITY_CRITICAL</a></div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00461">common.h:461</a></div></div>
<div class="ttc" id="structAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00078">AP_Param.h:78</a></div></div>
<div class="ttc" id="AP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="classDataFlash__Class_html"><div class="ttname"><a href="classDataFlash__Class.html">DataFlash_Class</a></div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00034">DataFlash.h:34</a></div></div>
<div class="ttc" id="structLocation_html_ad9759dba1fc13f13c531ebdcb2c9588e"><div class="ttname"><a href="structLocation.html#ad9759dba1fc13f13c531ebdcb2c9588e">Location::flags</a></div><div class="ttdeci">Location_Option_Flags flags</div><div class="ttdoc">options bitmask (1<<0 = relative altitude) </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00115">AP_Common.h:115</a></div></div>
<div class="ttc" id="AP__Common_8h_html"><div class="ttname"><a href="AP__Common_8h.html">AP_Common.h</a></div><div class="ttdoc">Common definitions and utility routines for the ArduPilot libraries. </div></div>
<div class="ttc" id="DataFlash_8h_html_abb538c2d6b6fe352804f947787a3e378a56f0896cdc3abc3a60a2c5c913b8e0f1"><div class="ttname"><a href="DataFlash_8h.html#abb538c2d6b6fe352804f947787a3e378a56f0896cdc3abc3a60a2c5c913b8e0f1">LOG_TERRAIN_MSG</a></div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00953">DataFlash.h:953</a></div></div>
<div class="ttc" id="DataFlash_8h_html"><div class="ttname"><a href="DataFlash_8h.html">DataFlash.h</a></div></div>
<div class="ttc" id="structLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="structLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdoc">param 4 - Longitude * 10**7 </div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00124">AP_Common.h:124</a></div></div>
<div class="ttc" id="AP__Math_8h_html_ab0e06d28afb9d14043e1938af277396c"><div class="ttname"><a href="AP__Math_8h.html#ab0e06d28afb9d14043e1938af277396c">location_update</a></div><div class="ttdeci">void location_update(struct Location &amp;loc, float bearing, float distance)</div><div class="ttdef"><b>Definition:</b> <a href="location_8cpp_source.html#l00121">location.cpp:121</a></div></div>
<div class="ttc" id="classAP__AHRS__DCM_html_ac8f908b8d8551b3201a104d03a5c31b7"><div class="ttname"><a href="classAP__AHRS__DCM.html#ac8f908b8d8551b3201a104d03a5c31b7">AP_AHRS_DCM::get_position</a></div><div class="ttdeci">virtual bool get_position(struct Location &amp;loc) const </div><div class="ttdef"><b>Definition:</b> <a href="AP__AHRS__DCM_8cpp_source.html#l00956">AP_AHRS_DCM.cpp:956</a></div></div>
<div class="ttc" id="AP__Terrain_8h_html"><div class="ttname"><a href="AP__Terrain_8h.html">AP_Terrain.h</a></div></div>
<div class="ttc" id="AHRS__Test_8cpp_html_a0a15280249072432f8c559cc00d09dee"><div class="ttname"><a href="AHRS__Test_8cpp.html#a0a15280249072432f8c559cc00d09dee">ahrs</a></div><div class="ttdeci">AP_AHRS_DCM ahrs(ins, baro, gps)</div></div>
<div class="ttc" id="classDataFlash__Class_html_a2838cdd106ad3dd8da69a45dd64117ca"><div class="ttname"><a href="classDataFlash__Class.html#a2838cdd106ad3dd8da69a45dd64117ca">DataFlash_Class::WriteBlock</a></div><div class="ttdeci">bool WriteBlock(const void *pBuffer, uint16_t size)</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8cpp_source.html#l00015">DataFlash.cpp:15</a></div></div>
<div class="ttc" id="AP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8h_source.html#l00053">AP_Param.h:53</a></div></div>
<div class="ttc" id="classAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition:</b> <a href="HAL_8h_source.html#l00087">HAL.h:87</a></div></div>
<div class="ttc" id="structlog__TERRAIN_html"><div class="ttname"><a href="structlog__TERRAIN.html">log_TERRAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00593">DataFlash.h:593</a></div></div>
<div class="ttc" id="DataFlash_8h_html_abca6b52da10346c72b10dd04698e4420"><div class="ttname"><a href="DataFlash_8h.html#abca6b52da10346c72b10dd04698e4420">LOG_PACKET_HEADER_INIT</a></div><div class="ttdeci">#define LOG_PACKET_HEADER_INIT(id)</div><div class="ttdef"><b>Definition:</b> <a href="DataFlash_8h_source.html#l00177">DataFlash.h:177</a></div></div>
<div class="ttc" id="structLocation__Option__Flags_html_a3f0f17e655550917bc3177e876d6dc14"><div class="ttname"><a href="structLocation__Option__Flags.html#a3f0f17e655550917bc3177e876d6dc14">Location_Option_Flags::relative_alt</a></div><div class="ttdeci">uint8_t relative_alt</div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00107">AP_Common.h:107</a></div></div>
<div class="ttc" id="classAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition:</b> <a href="AP__Param_8cpp_source.html#l00929">AP_Param.cpp:929</a></div></div>
<div class="ttc" id="structLocation_html"><div class="ttname"><a href="structLocation.html">Location</a></div><div class="ttdef"><b>Definition:</b> <a href="AP__Common_8h_source.html#l00113">AP_Common.h:113</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 14 2015 23:43:18 for APM:Libraries by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
